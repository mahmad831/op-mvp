#:kivy 2.3.0
#:import dp kivy.metrics.dp

< PillButton@ButtonBehavior+BoxLayout >:
    text: ""
    radius: dp(18)
    padding: dp(18), dp(16)
    spacing: dp(12)
    size_hint_y: None
    height: dp(64)
    canvas.before:
        Color: rgba: 0.20, 0.78, 0.36, 1
        RoundedRectangle: pos: self.pos; size: self.size; radius: [self.radius,]
    Label:
        text: root.text; color: 1,1,1,1; bold: True; font_size: '18sp'; halign: 'left'; valign: 'middle'; text_size: self.size
    Widget: size_hint_x: None; width: dp(24)

< HomeScreen >:
    name: "home"
    canvas.before: Color: rgba: 0.08,0.08,0.08,1; Rectangle: pos: self.pos; size: self.size
    BoxLayout:
        orientation: 'vertical'; size_hint: 0.9, None; height: self.minimum_height; spacing: dp(16)
        pos_hint: {'center_x':0.5,'center_y':0.5}
        Widget: size_hint_y: None; height: dp(20)
        Label: text: "Opticia"; color: 1,1,1,1; bold: True; font_size: '32sp'; size_hint_y: None; height: dp(48)
        Widget: size_hint_y: None; height: dp(10)
        PillButton: text: "Camera"; on_release: app.change_screen("gaze")
        PillButton: text: "Accessibility"; on_release: app.change_screen("settings")
        PillButton: text: "Microphone"; on_release: app.change_screen("auth")
        PillButton: text: "Next"; on_release: app.change_screen("demo_hub")
        Widget: size_hint_y: None; height: dp(8)

< AuthScreen >:
    name: "auth"
    canvas.before: Color: rgba: .08,.08,.08,1; Rectangle: pos: self.pos; size: self.size
    BoxLayout:
        orientation: 'vertical'; size_hint: 0.9, None; height: self.minimum_height; spacing: dp(12)
        pos_hint: {'center_x':.5,'center_y':.5}
        Label: text: "Face Authentication"; color: 1,1,1,1; bold: True; font_size: '28sp'; size_hint_y: None; height: dp(40)
        Label: text: root.status; color: .9,.9,.9,1; size_hint_y: None; height: dp(30)
        PillButton: text: "Register My Face"; on_release: root.do_register()
        PillButton: text: "Authenticate"; on_release: root.do_auth()
        PillButton: text: "Back"; on_release: app.change_screen("home")

< GazeControlScreen >:
    name: "gaze"
    preview: preview
    cursor: cursor
    canvas.before: Color: rgba: .08,.08,.08,1; Rectangle: pos: self.pos; size: self.size
    FloatLayout:
        # Camera preview
        Image:
            id: preview
            allow_stretch: True; keep_ratio: True
            size_hint: 0.9, 0.5
            pos_hint: {'center_x':0.5, 'top': 0.92}
        # Controls the cursor can click
        BoxLayout:
            id: controls
            orientation: 'vertical'; size_hint: 0.9, 0.28; spacing: dp(10)
            pos_hint: {'center_x':0.5, 'y': 0.05}
            Button: text: "A"; size_hint_y: None; height: dp(52)
            Button: text: "B"; size_hint_y: None; height: dp(52)
            Button: text: "C"; size_hint_y: None; height: dp(52)
        # Cursor (eye controlled)
        Widget:
            id: cursor
            size_hint: None, None; size: dp(32), dp(32)
            canvas:
                Color: rgba: 0.2,0.8,1,0.95
                Ellipse: pos: self.pos; size: self.size

< DemoHubScreen >:
    name: "demo_hub"
    canvas.before: Color: rgba: .08,.08,.08,1; Rectangle: pos: self.pos; size: self.size
    BoxLayout:
        orientation: 'vertical'; size_hint: 0.9, None; height: self.minimum_height; spacing: dp(12)
        pos_hint: {'center_x':.5,'center_y':.5}
        Label: text: "Eye Control Demos"; color: 1,1,1,1; bold: True; font_size: '28sp'; size_hint_y: None; height: dp(40)
        PillButton: text: "Buttons Demo"; on_release: app.change_screen("buttons_demo")
        PillButton: text: "Gaze Typing"; on_release: app.change_screen("keyboard_demo")
        PillButton: text: "Drawing Pad"; on_release: app.change_screen("draw_demo")
        PillButton: text: "Media Controls"; on_release: app.change_screen("media_demo")
        PillButton: text: "Mini Game"; on_release: app.change_screen("game_demo")
        PillButton: text: "Back"; on_release: app.change_screen("home")

< SettingsScreen >:
    name: "settings"
    canvas.before: Color: rgba: .08,.08,.08,1; Rectangle: pos: self.pos; size: self.size
    BoxLayout:
        orientation: 'vertical'; size_hint: .92, None; height: self.minimum_height; spacing: dp(12)
        pos_hint: {'center_x':.5,'center_y':.5}
        Label: text: "Accessibility Settings"; color: 1,1,1,1; bold: True; font_size: '28sp'; size_hint_y: None; height: dp(42)
        BoxLayout: size_hint_y: None; height: dp(48)
            Label: text: "Sensitivity"; color: 1,1,1,1
            Slider: min: 0.3; max: 2.0; value: 1.0
        BoxLayout: size_hint_y: None; height: dp(48)
            Label: text: "Dwell Time (s)"; color: 1,1,1,1
            Slider: min: 0.5; max: 3.0; value: 1.0
        BoxLayout: size_hint_y: None; height: dp(48)
            Label: text: "Sound Feedback"; color: 1,1,1,1
            ToggleButton: text: "OFF"; on_state: self.text.__setitem__(slice(None), "ON" if self.state=="down" else "OFF")
        PillButton: text: "Back"; on_release: app.change_screen("home")

< HelpScreen >:
    name: "help"
    canvas.before: Color: rgba: .08,.08,.08,1; Rectangle: pos: self.pos; size: self.size
    BoxLayout:
        orientation: 'vertical'; size_hint: .92, None; height: self.minimum_height; spacing: dp(10)
        pos_hint: {'center_x':.5,'center_y':.5}
        Label: text: "Help / Manual"; color: 1,1,1,1; bold: True; font_size: '28sp'; size_hint_y: None; height: dp(40)
        Label:
            text: "• Good lighting.\\n• 30–40cm distance.\\n• Move eyes more than head.\\n• Hold steady to click."
            color: .9,.9,.9,1; halign: 'left'; valign: 'top'; text_size: self.size
        PillButton: text: "Back"; on_release: app.change_screen("home")

# Demos (containers only—widgets are implemented in demos/*.py)
<ButtonsDemoScreen>: name: "buttons_demo"; canvas.before: Color: rgba: .08,.08,.08,1; Rectangle: pos: self.pos; size: self.size
    BoxLayout: orientation: 'vertical'; size_hint: .9, None; height: self.minimum_height; spacing: dp(12); pos_hint: {'center_x':.5,'center_y':.5}
        Label: text: "Eye-Controlled Buttons"; color: 1,1,1,1; bold: True; font_size: '26sp'; size_hint_y: None; height: dp(40)
        ButtonsDemo: id: bdemo; size_hint_y: None; height: dp(220)
        Label: text: bdemo.status_text; color: 1,1,1,1; size_hint_y: None; height: dp(30)
        PillButton: text: "Back"; on_release: app.change_screen("demo_hub")

<KeyboardDemoScreen>: name: "keyboard_demo"; canvas.before: Color: rgba: .08,.08,.08,1; Rectangle: pos: self.pos; size: self.size
    BoxLayout: orientation: 'vertical'; size_hint: .94, None; height: self.minimum_height; spacing: dp(8); pos_hint: {'center_x':.5,'center_y':.5}
        Label: text: "Gaze Typing"; color: 1,1,1,1; bold: True; font_size: '26sp'; size_hint_y: None; height: dp(40)
        Label: text: kdemo.typed_text; color: 1,1,1,1; size_hint_y: None; height: dp(48)
        KeyboardDemo: id: kdemo; size_hint_y: None; height: dp(240)
        BoxLayout: size_hint_y: None; height: dp(50)
            PillButton: text: "Clear"; on_release: kdemo.clear_text()
            PillButton: text: "Back"; on_release: app.change_screen("demo_hub")

<DrawDemoScreen>: name: "draw_demo"; canvas.before: Color: rgba: .08,.08,.08,1; Rectangle: pos: self.pos; size: self.size
    BoxLayout: orientation: 'vertical'; size_hint: .94, .9; spacing: dp(8); pos_hint: {'center_x':.5,'center_y':.5}
        Label: text: "Drawing Pad"; color: 1,1,1,1; bold: True; font_size: '26sp'; size_hint_y: None; height: dp(40)
        DrawDemo: id: ddemo; size_hint: 1, 1
        PillButton: text: "Back"; on_release: app.change_screen("demo_hub")

<MediaDemoScreen>: name: "media_demo"; canvas.before: Color: rgba: .08,.08,.08,1; Rectangle: pos: self.pos; size: self.size
    BoxLayout: orientation: 'vertical'; size_hint: .9, None; height: self.minimum_height; spacing: dp(10); pos_hint: {'center_x':.5,'center_y':.5}
        Label: text: "Media Controls"; color: 1,1,1,1; bold: True; font_size: '26sp'; size_hint_y: None; height: dp(40)
        MediaDemo: id: mdemo; size_hint_y: None; height: dp(160)
        Label: text: mdemo.status_text; color: 1,1,1,1; size_hint_y: None; height: dp(28)
        PillButton: text: "Back"; on_release: app.change_screen("demo_hub")

<GameDemoScreen>: name: "game_demo"; canvas.before: Color: rgba: .08,.08,.08,1; Rectangle: pos: self.pos; size: self.size
    BoxLayout: orientation: 'vertical'; size_hint: .94, .92; spacing: dp(8); pos_hint: {'center_x':.5,'center_y':.5}
        Label: text: "Mini Game"; color: 1,1,1,1; bold: True; font_size: '26sp'; size_hint_y: None; height: dp(40)
        PongGame: id: pg; size_hint: 1, 1
        PillButton: text: "Back"; on_release: app.change_screen("demo_hub")
